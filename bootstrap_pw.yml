---
- hosts: localhost

  tasks:

    - name: create timestamp
      shell: date
      register: date

    - name: generate LDAP admin password
      shell: openssl rand -base64 20
      register: ldap

    - name: generate caldavd password
      shell: openssl rand -base64 20
      register: caldavd

    - name: generate postfix admin password
      shell: openssl rand -base64 20
      register: postfix

    - name: put passwords into file
      lineinfile:
        dest: ./passwords
        line: "{{ item }}"
        create: yes
        state: present
      with_items: [ 'Date: {{ date.stdout }}', 'ldapadminpassword: {{ ldap.stdout }}', 'caldavduserpassword: {{ caldavd.stdout }}', 'postfixuserpassword: {{ postfix.stdout }}' ]

    - name: capture passwords for display
      shell: cat passwords
      register: passwords

    - debug: var=passwords.stdout_lines
